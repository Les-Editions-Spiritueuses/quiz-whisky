<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Whisky - Connaisseur</title>
    <style>
        /* Couleurs et Th√®me Whisky */
        :root {
            --primary: #944d18; /* Whisky Ambr√©/Brun */
            --secondary: #fefcf5; /* Fond Clair */
            --dark: #2c3e50;
            --correct: #27ae60;
            --wrong: #c0392b;
            --barrel-brown: #5c3b1c; /* F√ªt plus fonc√© */
            --barrel-highlight: #7a4f29;
        }

        /* 1. Visuel Global */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--dark);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f4f6f7;
        }

        .quiz-container {
            background: white;
            width: 100%;
            max-width: 600px;
            border-radius: 12px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            overflow: hidden;
            padding: 30px;
            transition: all 0.3s ease-in-out;
        }

        /* 2. Styles de la Page d'Accueil */
        #welcome-area {
            text-align: center;
        }

        .welcome-title {
            color: var(--primary);
            font-size: 2.5em;
            margin-bottom: 10px;
            border-bottom: 3px solid var(--primary);
            display: inline-block;
            padding-bottom: 5px;
        }

        /* Style pour l'image de distillerie */
        .distillery-image {
            width: 100%;
            max-height: 250px;
            object-fit: cover;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .welcome-description {
            font-size: 1.1em;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        /* Styles du Quiz */
        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 10px;
        }

        .header h1 { margin: 0; color: var(--dark); font-size: 1.5em;}
        
        /* Conteneur de la progression (Question # et Chrono) */
        .progress-bar-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            font-size: 1em; 
            font-weight: bold;
            color: var(--dark);
        }

        .question-progress-live { color: var(--primary); }
        .chrono-live { color: var(--dark); }


        .question-card { margin-bottom: 20px; }
        
        .question-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: var(--primary);
            margin-bottom: 10px;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .question-text::before {
            content: "ü•É ";
            font-size: 1.2em;
            margin-right: 5px;
            color: var(--primary);
        }
        
        .question-text {
            font-size: 1.2em;
            margin-bottom: 20px;
            line-height: 1.5;
            padding-left: 5px;
        }

        .options-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option-btn {
            background: white;
            border: 2px solid #bdc3c7;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            text-align: left;
            transition: all 0.2s;
        }

        .option-btn:hover:not(:disabled) {
            border-color: var(--primary);
            background-color: var(--secondary);
        }

        .option-btn.correct {
            background-color: #d4efdf;
            border-color: var(--correct);
            color: var(--correct);
        }

        .option-btn.wrong {
            background-color: #fadbd8;
            border-color: var(--wrong);
            color: var(--wrong);
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            background-color: #ecf0f1;
            display: none;
        }

        /* Style pour les boutons g√©n√©raux */
        .action-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.2s;
        }

        .action-btn:hover { background-color: #7a4f29; }
        
        .results-card {
            text-align: center;
        }
        
        .final-score {
            font-size: 3em;
            font-weight: bold;
            color: var(--primary);
        }
        
        /* Style pour le bouton d'envoi des r√©sultats */
        #send-results-btn {
            margin-top: 15px;
            background-color: var(--correct);
            border-color: var(--correct);
        }
        #send-results-btn:hover {
            background-color: #229954;
        }
    </style>
</head>
<body>

<div class="quiz-container">
    
    <div id="welcome-area">
        <h1 class="welcome-title">Quiz Whisky</h1>
        
        <img id="distillery-image-placeholder" class="distillery-image" alt="Illustration de distillerie de whisky">
        
        <p class="welcome-description">
            Avec Les Editions Spiritueuses, testez vos connaissances sur le whisky ! Plongez dans son univers fascinant et d√©couvrez si vous √™tes un v√©ritable connaisseur de ce spiritueux l√©gendaire !
        </p>
        <p style="font-weight: bold; color: #944d18; border: 1px dashed #944d18; padding: 10px; margin-top: 20px;">
        ‚ö†Ô∏è R√àGLE DE SCORING : Le score final est pond√©r√© par le temps de r√©ponse. Le temps cible est de **2 minutes (120 secondes)**. Si vous d√©passez 2 minutes, votre Index de Performance sera l√©g√®rement p√©nalis√©.
    </p>
        <button class="action-btn" onclick="startQuiz()">Commencer le Quiz</button>
    </div>

    <div id="quiz-area" style="display:none;">
        <div class="header">
            <h1>Connaisseur du Whisky</h1>
            
            <div class="progress-bar-container">
                <span id="question-progress-live" class="question-progress-live">Question 0 / 15</span> 
                <span id="chrono-live" class="chrono-live">00:00</span>
            </div>
        </div>

        <div class="question-card">
            <div class="question-meta">
                <span id="q-difficulty">Difficult√©</span>
                <span id="q-points">Points</span>
            </div>
            <div class="question-text" id="question-text"></div>
            <div class="options-grid" id="options-container">
                </div>
        </div>

        <div class="feedback" id="feedback-area"></div>
        <button class="action-btn" id="next-btn" style="display:none" onclick="nextQuestion()">Question Suivante</button>
    </div>

    <div class="results-card" id="results-area" style="display:none;">
        <h2>Quiz Termin√© !</h2>
        
        <p style="font-size: 1.2em; color: var(--primary); font-weight: bold;">
            Pour voir les r√©sultats, renseignez votre pseudo :
        </p>

        <input type="text" id="pseudo-input" placeholder="Votre Pseudo (requis)" 
            style="padding: 10px; width: 80%; margin-top: 15px; border: 1px solid #ccc; border-radius: 5px;"
            oninput="handlePseudoInput(this.value)"> 
        
        <button class="action-btn" id="send-results-btn" style="display:none;" onclick="sendResultFromButton()">
            Enregistrer mon r√©sultat
        </button>
        
        <div id="final-results-display" style="display:none;">
            
            <p id="raw-score-display" style="font-size: 1.2em; font-weight: bold; margin-bottom: 5px; color: var(--dark);"></p>

            <p id="time-taken-display" style="font-weight: bold; margin-bottom: 20px; color: var(--barrel-brown);"></p>
            
            <p>Votre **Index de Performance** est de :</p>
            <div class="final-score"><span id="final-score-val">0%</span></div>

            <p id="final-message"></p>
            
            <p id="send-status" style="font-weight: bold; color: var(--correct); margin-top: 10px;"></p>
        </div>

        <button class="action-btn" style="background-color: #34495e;" onclick="location.reload()">Recommencer</button>
 <button class="action-btn" style="background-color: #34495e;" onclick="location.reload()">Recommencer</button>

<button class="action-btn" 
    id="rhum-quiz-link" 
    style="background-color: #d35400; /* Couleur Rhum */
           margin-top: 10px;
           display: none;" onclick="window.location.href='https://les-editions-spiritueuses.github.io/quiz-rhum'">
    Testez vos connaissances sur le Rhum üßâ
</button>
    </div>


<script>
    // -------------------------------------------------------------------
    // URL BRUTE (RAW) DE L'IMAGE GITHUB (√Ä CHANGER pour une image whisky)
    // -------------------------------------------------------------------
    // DANS VOTRE FICHIER index.html
const DISTILLERY_IMAGE_URL = "https://raw.githubusercontent.com/Les-Editions-Spiritueuses/quiz-whisky/main/Distillerie-whisky.jpg"; 

    // VOTRE URL DE DEPLOIEMENT GOOGLE APPS SCRIPT
    // REMPLACER cette cha√Æne par votre propre URL de d√©ploiement Google Apps Script !
    const GAS_URL = "https://script.google.com/macros/s/AKfycbyKCoo68vq5DbX4v2vlSLGGkKigeDWeoEF3dMOxwP7tllx5MPADuSzvLxpOeMGM1PNB4Q/exec";
    
    // NOM DE L'ONGLET GOOGLE SHEET CIBLE - TR√àS IMPORTANT !
    const TARGET_SHEET_NAME = "Resultats Quiz 2"; 
    // VEUILLEZ V√âRIFIER que votre Google Apps Script est adapt√© pour utiliser cette variable.

    let resultSent = false; 
    let chronoInterval; 
    
    // Donn√©es du Quiz Whisky (Adapt√©es de votre fichier DOCX)
    const quizData = [
        {
            q: "Quelle mati√®re premi√®re est exclusivement utilis√©e dans la production d‚Äôun whisky \"single malt\" ?",
            options: ["Un m√©lange d‚Äôorge malt√©e et non malt√©e", "Uniquement de l‚Äôorge malt√©e provenant d‚Äôune seule distillerie", "Diff√©rentes c√©r√©ales distill√©es s√©par√©ment puis assembl√©es"],
            correct: 1, // Uniquement de l‚Äôorge malt√©e provenant d‚Äôune seule distillerie
            points: 1,
            explanation: "Le terme 'single malt' implique une base 100 % orge malt√©e, issue d‚Äôune seule distillerie."
        },
        {
            q: "Qu‚Äôest-ce qui caract√©rise principalement un whisky \"Rye\" par rapport √† un Bourbon ?",
            options: ["Une distillation en colonne √† plus forte temp√©rature", "Une proportion majoritaire de seigle dans la composition", "Un vieillissement exclusivement en f√ªts de ch√™ne usag√©s"],
            correct: 1, // Une proportion majoritaire de seigle
            points: 2,
            explanation: "Le Rye whiskey est d√©fini par l'utilisation d'au moins 51 % de seigle."
        },
        {
            q: "Quel est l‚Äôimpact principal de la triple distillation sur le profil aromatique du whiskey irlandais ?",
            options: ["Elle √©pure davantage l‚Äôalcool pour un rendu plus fluide et a√©rien", "Elle renforce la pr√©sence d‚Äôar√¥mes de fermentation", "Elle permet un taux d‚Äôalcool plus √©lev√© avant dilution"],
            correct: 0, // Plus fluide et a√©rien
            points: 3,
            explanation: "La triple distillation donne des whiskeys plus doux et ronds, caract√©ristiques de l‚ÄôIrlande."
        },
        {
            q: "Quelle est la fonction r√©elle de la tourbe dans la fabrication de certains whiskies ?",
            options: ["Elle sert de combustible au s√©chage du malt, en transmettant des ar√¥mes fum√©s", "Elle est utilis√©e pour aromatiser les f√ªts apr√®s distillation", "Elle est ajout√©e en fermentation pour favoriser la levure"],
            correct: 0, // S√©chage du malt avec ar√¥mes fum√©s
            points: 2,
            explanation: "La tourbe est br√ªl√©e lors du s√©chage du malt, infusant des compos√©s ph√©noliques au grain."
        },
        {
            q: "Quelle affirmation d√©crit le mieux l'effet du climat tropical sur le vieillissement du whisky ?",
            options: ["Il permet une oxydation lente qui pr√©serve la complexit√©", "Il ralentit le d√©veloppement aromatique mais augmente la couleur", "Il acc√©l√®re les √©changes bois/alcool et accentue la part des anges"],
            correct: 2, // Acc√©l√®re les √©changes
            points: 3,
            explanation: "Un climat chaud comme √† Ta√Øwan ou en Inde augmente l‚Äôintensit√© et la vitesse de maturation."
        },
        {
            q: "Quelle est la cons√©quence sensorielle la plus typique du vieillissement en f√ªt de sherry ?",
            options: ["Une structure tannique dominante et s√®che", "Une richesse aromatique autour des fruits secs, noix et √©pices douces", "Un profil exclusivement bois√© et min√©ral"],
            correct: 1, // Fruits secs, noix et √©pices douces
            points: 2,
            explanation: "Le sherry influence les whiskies par des ar√¥mes chaleureux et fruit√©s, parfois oxydatifs."
        },
        {
            q: "Le \"Single Pot Still\", embl√©matique de l‚ÄôIrlande, se distingue principalement par :",
            options: ["L‚Äôusage d‚Äôun pot still double compartiment√©", "La pr√©sence d‚Äôorge non malt√©e aux c√¥t√©s de l‚Äôorge malt√©e", "Un vieillissement syst√©matique en f√ªt de cidre"],
            correct: 1, // Orge non malt√©e
            points: 2,
            explanation: "C‚Äôest l‚Äôajout d‚Äôorge non malt√©e qui donne au Single Pot Still son profil unique."
        },
        {
            q: "Quelle est la sp√©cificit√© du bois de Mizunara, utilis√© dans certains whiskies japonais ?",
            options: ["Il apporte des ar√¥mes rares comme le santal, l‚Äôencens et la noix de coco", "Il concentre davantage les notes fum√©es par son grain serr√©", "Il favorise l‚Äôoxydation gr√¢ce √† sa porosit√© unique"],
            correct: 0, // Santal, encens et noix de coco
            points: 3,
            explanation: "Le Mizunara est appr√©ci√© pour ses ar√¥mes subtils et complexes, et sa raret√©."
        },
        {
            q: "Quelle est la dur√©e minimale de vieillissement l√©gal pour qu‚Äôun spiritueux soit consid√©r√© comme un whisky ?",
            options: ["2 ans, uniquement si √©lev√© sous bois", "4 ans, sauf pour les whiskies de grain", "3 ans, dans des f√ªts de bois d‚Äôun volume d√©fini"],
            correct: 2, // 3 ans
            points: 1,
            explanation: "Selon la r√©glementation europ√©enne (et dans le guide), le whisky doit vieillir au moins 3 ans."
        },
        {
            q: "Quel facteur r√©gional a l‚Äôimpact le plus notable sur le style d‚Äôun whisky ?",
            options: ["La qualit√© de l‚Äôeau de r√©duction utilis√©e", "Le climat et l‚Äôenvironnement de vieillissement", "La hauteur des colonnes de distillation"],
            correct: 1, // Climat et environnement
            points: 3,
            explanation: "Climat, hygrom√©trie et temp√©rature jouent un r√¥le cl√© dans la maturation."
        },
        {
            q: "Quelle famille aromatique est typique des whiskies √©cossais du Speyside ?",
            options: ["Notes marines, min√©rales et salines", "Ar√¥mes fruit√©s, floraux, avec des touches de miel", "Nez r√©sineux et bois√© dominant"],
            correct: 1, // Fruit√©, floral, miel
            points: 1,
            explanation: "Le Speyside est c√©l√®bre pour ses malts doux, √©l√©gants, aux fruits m√ªrs et aux fleurs."
        },
        {
            q: "Pourquoi le whisky fran√ßais est-il souvent vu comme un laboratoire de styles ?",
            options: ["Il est syst√©matiquement vieilli en f√ªts de Cognac", "Il n‚Äôest soumis √† aucune tradition stricte et explore de nombreux √©levages", "Il est produit √† partir de pommes et d‚Äôorge"],
            correct: 1, // N'est soumis √† aucune tradition stricte
            points: 2,
            explanation: "La cr√©ativit√© du whisky fran√ßais s‚Äôexprime via des f√ªts vari√©s et des techniques hybrides."
        },
        {
            q: "Dans quel type d‚Äôalambic la majorit√© des single malts sont-ils distill√©s ?",
            options: ["Alambic continu √† plateau", "Pot still en cuivre", "Alambic √† reflux fractionn√©"],
            correct: 1, // Pot still en cuivre
            points: 1,
            explanation: "Les pot stills en cuivre sont la norme pour les single malts √©cossais."
        },
        {
            q: "Quelle tendance mondiale influence le plus la diversification des whiskies ?",
            options: ["L‚Äôharmonisation des recettes entre les grandes marques", "L‚Äô√©mergence de pays producteurs non traditionnels adoptant des styles innovants", "L‚Äôimposition de normes globales de vieillissement"],
            correct: 1, // √âmergence de pays producteurs non traditionnels
            points: 3,
            explanation: "Le d√©veloppement de styles nordiques, asiatiques ou mexicains cr√©e une nouvelle dynamique."
        },
        {
            q: "Quelle est la particularit√© du Bourbon concernant ses f√ªts de vieillissement ?",
            options: ["L‚Äôusage obligatoire de f√ªts ayant contenu du vin doux", "L‚Äôemploi exclusif de f√ªts neufs en ch√™ne am√©ricain br√ªl√©s", "L‚Äôajout d‚Äô√©clats de bois pendant la fermentation"],
            correct: 1, // F√ªts neufs en ch√™ne am√©ricain br√ªl√©s
            points: 2,
            explanation: "Le Bourbon doit √™tre vieilli en f√ªt neuf, fortement toast√© ‚Äì c‚Äôest la loi."
        }
    ];

    let currentQuestionIndex = 0;
    let score = 0;
    const MAX_SCORE = 30; 
    
    // Variables de temps
    let startTime;
    let timeTakenSeconds = 0;
    let performanceIndex = 0; 

    // √âl√©ments du DOM
    const welcomeArea = document.getElementById("welcome-area");
    const quizArea = document.getElementById("quiz-area");
    const resultsArea = document.getElementById("results-area");

    const questionText = document.getElementById("question-text");
    const optionsContainer = document.getElementById("options-container");
    const pointsDisplay = document.getElementById("q-points");
    const feedbackArea = document.getElementById("feedback-area");
    const nextBtn = document.getElementById("next-btn");
    
    // √âl√©ments de progression et d'image
    const questionProgressLive = document.getElementById("question-progress-live"); 
    const chronoLiveDisplay = document.getElementById("chrono-live");
    const sendResultsBtn = document.getElementById("send-results-btn");
    const distilleryImage = document.getElementById("distillery-image-placeholder");

    // Chargement de l'image de la distillerie au d√©marrage
    distilleryImage.src = DISTILLERY_IMAGE_URL;
    distilleryImage.onerror = function() {
        // Fallback si l'image GitHub ne charge pas
        this.src = "https://placehold.co/600x250/944d18/ffffff?text=Image+Distillerie+Whisky";
        console.error("L'image de la distillerie n'a pas pu √™tre charg√©e. V√©rifiez l'URL brute (Raw) GitHub.");
    };


    /**
     * Met √† jour le chronom√®tre affich√©.
     */
    function updateChrono() {
        const currentTime = new Date();
        timeTakenSeconds = Math.round((currentTime - startTime) / 1000); 
        const minutes = String(Math.floor(timeTakenSeconds / 60)).padStart(2, '0');
        const seconds = String(timeTakenSeconds % 60).padStart(2, '0');
        chronoLiveDisplay.textContent = `${minutes}:${seconds}`;
    }

    /**
     * Lance le quiz en cachant la page d'accueil et D√âMARRE LE CHRONOM√àTRE.
     */
    function startQuiz() {
        welcomeArea.style.display = "none";
        quizArea.style.display = "block";
        startTime = new Date(); // D√©marrage du chronom√®tre
        chronoInterval = setInterval(updateChrono, 1000); // Mise √† jour toutes les secondes
        loadQuestion();
    }

    function loadQuestion() {
        const currentData = quizData[currentQuestionIndex];
        
        questionText.textContent = currentData.q;
        pointsDisplay.textContent = currentData.points + (currentData.points > 1 ? " Points" : " Point");
        
        // MISE √Ä JOUR DU NUM√âRO DE QUESTION
        questionProgressLive.textContent = `Question ${currentQuestionIndex + 1} / ${quizData.length}`;
        
        optionsContainer.innerHTML = "";
        feedbackArea.style.display = "none";
        nextBtn.style.display = "none";

        currentData.options.forEach((opt, index) => {
            const btn = document.createElement("button");
            btn.className = "option-btn";
            btn.textContent = opt;
            btn.onclick = () => checkAnswer(index, btn);
            optionsContainer.appendChild(btn);
        });
    }

    function checkAnswer(selectedIndex, btnElement) {
        const currentData = quizData[currentQuestionIndex];
        const buttons = optionsContainer.querySelectorAll(".option-btn");
        
        // D√©sactiver tous les boutons
        buttons.forEach(btn => btn.disabled = true);

        if (selectedIndex === currentData.correct) {
            btnElement.classList.add("correct");
            score += currentData.points;
            feedbackArea.innerHTML = `<strong>Correct !</strong> <br>${currentData.explanation}`;
            feedbackArea.style.borderLeft = "5px solid var(--correct)";
        } else {
            btnElement.classList.add("wrong");
            buttons[currentData.correct].classList.add("correct");
            feedbackArea.innerHTML = `<strong>Incorrect.</strong> La bonne r√©ponse √©tait : <em>${currentData.options[currentData.correct]}</em><br>${currentData.explanation}`;
            feedbackArea.style.borderLeft = "5px solid var(--wrong)";
        }

        feedbackArea.style.display = "block";
        nextBtn.style.display = "block";
        
        if (currentQuestionIndex === quizData.length - 1) {
            nextBtn.textContent = "Voir les r√©sultats";
        }
    }

    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < quizData.length) {
            loadQuestion();
        } else {
            showResults();
        }
    }


    /**
     * Affiche les r√©sultats, calcule le temps et l'Index de Performance
     */
    function showResults() {
        clearInterval(chronoInterval); // Arr√™ter le chronom√®tre
        quizArea.style.display = "none";
        resultsArea.style.display = "block";
        
        // On masque l'affichage des r√©sultats finaux en attendant que le pseudo soit renseign√©
        document.getElementById("final-results-display").style.display = "none";
        
        // --- 1. Calcul du temps √©coul√© ---
        const minutes = Math.floor(timeTakenSeconds / 60);
        const seconds = timeTakenSeconds % 60;
        const timeDisplay = `${minutes} min ${seconds} sec`;

        // --- 2. Calcul du Score Pond√©r√© (Index de Performance) ---
        const rawPercentage = (score / MAX_SCORE) * 100;
        
        const TARGET_TIME_SECONDS = 120; // Temps cible: 2 minutes (120 secondes)
        
        let timeFactor = 1;
        if (timeTakenSeconds > TARGET_TIME_SECONDS) {
            // Malus : 0.1% de malus par seconde au-del√† du temps cible
            timeFactor = 1 - ((timeTakenSeconds - TARGET_TIME_SECONDS) * 0.001);
            timeFactor = Math.max(0.5, timeFactor); // Limite du malus √† 50%
        }

        // On stocke le r√©sultat dans la variable globale pour l'envoi
        performanceIndex = Math.round(rawPercentage * timeFactor);
        performanceIndex = Math.max(0, Math.min(100, performanceIndex));


        // --- 3. Mise √† jour des valeurs de l'√©cran de r√©sultats ---
        document.getElementById("final-score-val").textContent = performanceIndex + "%"; 
        
        // Afficher le score brut (X/30)
        document.getElementById("raw-score-display").textContent = `Score brut : ${score} / ${MAX_SCORE} Points`;

        document.getElementById("time-taken-display").textContent = `Dur√©e totale : ${timeDisplay}`;


        const msg = document.getElementById("final-message");
        if (performanceIndex === 100) {
            msg.textContent = "F√©licitations ! Vous √™tes un Ma√Ætre du Whisky avec une rapidit√© impressionnante ! ü•É";
        } else if (performanceIndex >= 75) {
            msg.textContent = "Index de Performance Excellent ! Votre connaissance et votre rapidit√© sont au top.";
        } else if (performanceIndex >= 35) {
            msg.textContent = "Index Correct. Vous avez de bonnes bases, mais tentez d'√™tre plus rapide la prochaine fois !";
        } else {
            msg.textContent = "C'est un d√©but. Acc√©l√©rez le rythme !";
        }
        
        // Initialiser le statut d'envoi
        document.getElementById('send-status').textContent = "Statut : Pr√™t √† envoyer.";
    }
    
    // -------------------------------------------------------------------
    // FONCTION POUR ENVOYER LES R√âSULTATS (Avec Exponential Backoff)
    // -------------------------------------------------------------------
    async function sendResult(pseudo) {
        if (resultSent) return; 

        document.getElementById('send-status').textContent = "Envoi des r√©sultats en cours...";
        
        // Afficher d'abord les r√©sultats calcul√©s si ce n'est pas fait
        document.getElementById("final-results-display").style.display = "block";

        const dataToSend = {
            pseudo: pseudo,
            score: score,                  
            time: timeTakenSeconds,        
            performanceIndex: performanceIndex,
            // AJOUT DU NOM DE LA FEUILLE CIBLE
            targetSheet: TARGET_SHEET_NAME 
        };
        
        const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));
        const maxRetries = 3;
        let attempt = 0;
        let success = false;

        while (attempt < maxRetries && !success) {
            try {
                // Tentative d'envoi √† Google Apps Script
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    mode: 'no-cors', // N√©cessaire pour les appels cross-origin simples
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(dataToSend)
                });

                // Si le fetch r√©ussit sans erreur r√©seau (m√™me si la r√©ponse est opaque), on consid√®re que l'envoi a √©t√© tent√©.
                success = true;
                resultSent = true;
                document.getElementById('send-status').textContent = "‚úÖ R√©sultat enregistr√© !";
                sendResultsBtn.disabled = true; // D√©sactiver le bouton apr√®s l'envoi

            } catch (error) {
                attempt++;
                if (attempt < maxRetries) {
                    const waitTime = Math.pow(2, attempt) * 1000; 
                    // Pas de log d'erreur ici pour l'exponential backoff (consigne)
                    await delay(waitTime);
                } else {
                    console.error("Erreur lors de l'envoi des donn√©es √† Google Sheets (apr√®s plusieurs tentatives):", error);
                    document.getElementById('send-status').textContent = "‚ùå √âchec de l'enregistrement. V√©rifiez l'URL et les logs du script.";
                    resultSent = false;
                }
            }
        }
    }

    // -------------------------------------------------------------------
    // GESTION DE LA SAISIE DU PSEUDO (Afficher le bouton d'envoi)
    // -------------------------------------------------------------------

    function handlePseudoInput(pseudoValue) {
        const pseudoTrimmed = pseudoValue.trim();
        
        // Afficher ou masquer le bouton d'envoi en fonction de la saisie
        if (pseudoTrimmed.length > 0) {
            sendResultsBtn.style.display = "block";
        } else {
            sendResultsBtn.style.display = "none";
        }
        
        // Si le pseudo change APR√àS l'envoi initial, on permet de renvoyer (optionnel)
        if (resultSent) {
            resultSent = false;
            document.getElementById('send-status').textContent = "Statut : Pr√™t √† envoyer de nouveau.";
            sendResultsBtn.disabled = false;
        }
    }
    
    // -------------------------------------------------------------------
    // GESTION DU CLIC SUR LE BOUTON D'ENVOI
    // -------------------------------------------------------------------
    
    function sendResultFromButton() {
        const pseudoInput = document.getElementById('pseudo-input');
        const pseudo = pseudoInput.value.trim();

        if (pseudo.length > 0) {
            sendResult(pseudo);
        } else {
            document.getElementById('send-status').textContent = "Veuillez entrer un pseudo valide.";
            pseudoInput.focus();
        }
    }
    
    // Charger la premi√®re question au lancement du quiz
    // loadQuestion(); // Retir√©, car le quiz d√©marre via le bouton "Commencer"
</script>

</body>
</html>



